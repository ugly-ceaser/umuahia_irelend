
{% extends './_base.html' %}
{% load static %}

{% block page_title %}Settings{% endblock page_title %}

{% block content %}

<div class="max-w-7xl mx-auto py-12">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

      <!-- Update Password Form (Left Column) -->
      <div class="bg-white p-8 rounded-xl ">
        <h3 class="text-2xl font-bold text-gray-900 mb-4">Update Password</h3>
        <p class="text-gray-500 mb-6">Enter your current password to make an update</p>

        <div class="space-y-6">
          <!-- Current Password -->
          <div class="relative">
            <input
              type="password"
              id="current-password"
              placeholder="Current Password"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            >
            <button
              onclick="togglePassword('current-password')"
              class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-blue-500 cursor-pointer"
            >
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              </svg>
            </button>
          </div>

          <!-- New Password -->
          <div class="relative">
            <input
              type="password"
              id="new-password"
              placeholder="New Password"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            >
            <button
              onclick="togglePassword('new-password')"
              class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-blue-500 cursor-pointer"
            >
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              </svg>
            </button>
          </div>

          <!-- Update Button -->
          <button
            id="update-password-btn"
            class="w-full py-3 px-6 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200"
          >
            Update Password
          </button>
        </div>
      </div>

      <!-- Notification Settings (Right Column) -->
      <div class="bg-white p-8 rounded-xl ">
        <h3 class="text-2xl font-bold text-gray-900 mb-4">Notifications</h3>
        <p class="text-gray-500 mb-6">Select your preference by notification type</p>

        <div class="space-y-6">
          <!-- New Member Alerts -->
          <div class="flex items-center justify-between">
            <span class="text-gray-700">New Member Alerts</span>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" class="sr-only peer" checked>
              <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
            </label>
          </div>

          <!-- Minutes Updates -->
          <div class="flex items-center justify-between">
            <span class="text-gray-700">Minutes Updates</span>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" class="sr-only peer" checked>
              <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
            </label>
          </div>

          <!-- All Notifications -->
          <div class="flex items-center justify-between">
            <span class="text-gray-700">All Notifications</span>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" class="sr-only peer" checked>
              <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
            </label>
          </div>
        </div>
      </div>
    </div>
</div>

<script>
function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
    input.setAttribute('type', type);
}
</script>

<!-- Toast Notification -->
<div id="toast" class="toast">
    <img id="toast-icon" src="../img/checks.png" alt="Success" class="toast-icon">
    <div class="toast-content">
        <h4 id="toast-title">Success</h4>
        <p id="toast-message"></p>
    </div>
    <button class="close-btn" onclick="hideToast()">Ã—</button>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
    function showToast(title, message, isSuccess = true) {
        const toast = document.getElementById("toast");
        const toastTitle = document.getElementById("toast-title");
        const toastMessage = document.getElementById("toast-message");
        const toastIcon = document.getElementById("toast-icon");

        //  Toast content
        toastTitle.textContent = title;
        toastMessage.textContent = message;


        if (isSuccess) {
            toast.classList.remove("error");
            toast.classList.add("success");
            toastIcon.src = "../img/checks.png";
        } else {
            toast.classList.remove("success");
            toast.classList.add("error");
            toastIcon.src = "../img/errors.png";
        }

        toast.classList.add("show");

        setTimeout(() => {
            hideToast();
        }, 5000);
    }

    function hideToast() {
        document.getElementById("toast").classList.remove("show");
    }

    // Password update logic
    document.getElementById("update-password-btn").addEventListener("click", function () {
        const currentPassword = document.getElementById("current-password").value.trim();
        const newPassword = document.getElementById("new-password").value.trim();

        if (!currentPassword || !newPassword) {
            showToast("Error", "Please fill in both fields!", false);
            return;
        }

        if (newPassword.length < 6) {
            showToast("Error", "New password must be at least 6 characters long!", false);
            return;
        }

        setTimeout(() => {
            showToast("Success", "Password updated successfully!", true);
            document.getElementById("current-password").value = "";
            document.getElementById("new-password").value = "";
        }, 5000);
    });

// Toggle password visibility
        document.querySelectorAll(".password-container i").forEach(icon => {
            icon.addEventListener("click", function () {
                const input = this.previousElementSibling;
                if (input.type === "password") {
                    input.type = "text";
                    this.classList.replace("fa-eye", "fa-eye-slash");
                } else {
                    input.type = "password";
                    this.classList.replace("fa-eye-slash", "fa-eye");
                }
            });
        });

        // Notification Handling
        const notificationIcon = document.getElementById("notification-icon");
        const notificationModal = document.getElementById("notification-modal");
        const notificationList = document.getElementById("notification-list");
        const emptyNotifications = document.getElementById("empty-notifications");

        let notifications = [];

        function populateNotifications() {
            notificationList.innerHTML = "";

            if (notifications.length === 0) {
                notificationList.style.display = "none";
                emptyNotifications.style.display = "block";
            } else {
                notifications.forEach((n, index) => {
                    const listItem = document.createElement("li");
                    listItem.classList.add("notification-item");
                    if (n.unread) listItem.classList.add("unread");

                    listItem.innerHTML = `
                        <img src="profile.jpg" alt="User">
                        ${n.unread ? '<span class="active-dot"></span>' : ''}
                        <div class="notification-content">
                            <div class="notification-title">${n.title}</div>
                            <div class="notification-text">${n.message}</div>
                        </div>
                        <div class="notification-menu">
                            <i class="fas fa-ellipsis-v three-dot" onclick="toggleMenu(${index})"></i>
                            <div class="mark-read-menu" id="menu-${index}" onclick="markAsRead(${index})">Mark as Read</div>
                        </div>
                    `;
                    notificationList.appendChild(listItem);
                });

                notificationList.style.display = "block";
                emptyNotifications.style.display = "none";
            }
        }

        function toggleMenu(index) {
            document.querySelectorAll(".mark-read-menu").forEach(menu => menu.style.display = "none");
            document.getElementById(`menu-${index}`).style.display = "block";
        }

        function markAsRead(index) {
            notifications[index].unread = false;
            populateNotifications();
        }

        function showNotificationModal() {
            notificationModal.style.display = "block";
            populateNotifications();
        }

        function closeNotificationModal() {
            notificationModal.style.display = "none";
        }

        notificationIcon.addEventListener("click", showNotificationModal);
        document.addEventListener("click", function (event) {
            if (!notificationModal.contains(event.target) && event.target !== notificationIcon) {
                closeNotificationModal();
            }
        });
        populateNotifications();
    });

</script>
{% endblock content %}